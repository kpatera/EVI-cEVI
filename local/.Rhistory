new_l=l
new_se=evicut_t$sens
new_sp=evicut_t$spec
all_lag[[length(all_lag) + 1]] <- new_j
all_cut[[length(all_cut) + 1]] <- new_l
all_se[[length(all_se) + 1]] <- new_se
all_sp[[length(all_sp) + 1]] <- new_sp
}
}
sesp=as.data.frame(cbind(all_lag,all_cut,all_se,all_sp))
#Select the row with the right window and cut
index=which.max(sesp$all_se+sesp$all_sp-1)
#index=sesp[which(sesp$all_sp>0.80),]
#index=which.max(index$all_se)
#index=which(sesp$all_se==1 & sesp$all_sp>=0.95),1)
#if (i>40)
#   {index1=sesp[which(sesp$all_sp>0.95),]
#  index=which.max(index1$all_se)
#   }
#else
#{index=which.max(sesp$all_se+sesp$all_sp-1)}
#index=which(sesp$se>=0.6 & sesp$sp>0.9)
print(i)
print(sesp[index,])
#estimate the parameters for the last observed case
lag_n=sesp$all_lag[index]
c_n=sesp$all_cut[index]
roll_n=rollsd(cases[1:i],lag_n)
ev_n=evi(roll_n)
ind_n=indic(ev_n,c_n, case_t)
evicut_n=evifcut(ev_n, case_t, c_n, r)
roll=c(roll,roll_n[i])
ev=c(ev,ev_n[i])
ind=c(ind, ind_n[i])
lag_all=c(lag_all,lag_n)
c_all=c(c_all,c_n)
se_all=c(se_all,all_se[index])
sp_all=c(sp_all,all_sp[index])
pvs[i]=evicut_n$prev*all_se[index]/
(evicut_n$prev*all_se[index]+(1-evicut_n$prev)*(1-all_sp[index]))
pvn[i]=(1-evicut_n$prev)*all_sp[index]/
((1-evicut_n$prev)*all_sp[index]+evicut_n$prev*(1-all_se[index]))
}
Days=(1:length(cases))
EVI=ev
Cases=cases
Index=ind
EVI_out=as.data.frame(cbind(Days, EVI, Cases, Index, pvs, pvn,
lag_all, c_all, se_all, sp_all))
EVI_output<<-(EVI_out)
end_time = Sys.time()
time_elapsed = end_time - start_time
print(time_elapsed)
return(EVI_output)
}
temp=deviant(Italy$Cases)
temp
evi.graphs(temp)
devtools::document()
rm(deviant())
rm(deviant
)
devtools::document()
EVI_output=temp
EVI_output$cases_1=EVI_output$Cases*EVI_output$Index
EVI_output$cases_1[EVI_output$cases_1 == 0] <- NA
EVI_output$cases_0=EVI_output$Cases*(1-EVI_output$Index)
EVI_output$cases_0[EVI_output$cases_0 == 0] <- NA
EVI_output$pvn=EVI_output$pvn*(1-EVI_output$Index)
EVI_output$pvn[EVI_output$pvn == 0] <- NA
EVI_output$pvs=EVI_output$pvs*EVI_output$Index
EVI_output$pvs[EVI_output$pvs == 0] <- NA
ggplot(EVI_output, aes(x=Days))+
geom_point(aes(y=log(Cases), color=Index>0), size=0.5)+
scale_color_manual(values=c("grey69", "red3"))+
theme(legend.position = "none")+
labs(y = "ln(Cases)", x="Days")
type="p"
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type="l")  geom_line(aes(y=log(Cases), color=Index>0), size=0.5)
}
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type="l")  geom_line(aes(y=log(Cases), color=Index>0), size=0.5)
)
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_line(aes(y=log(Cases), color=Index>0), size=0.5)
)
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_line(aes(y=log(Cases), color=Index>0), size=0.5)
)
sp3
type="l"
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_line(aes(y=log(Cases), color=Index>0), size=0.5)
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_line(aes(y=log(Cases)), size=0.5)
)
sp3
?aes
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_line(aes(y=log(Cases), color=Index>0), size=0.5),
geom_segment(size = 2)
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
geom_segment(size = 2),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_line(aes(y=log(Cases), color=Index>0), size=0.5),
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
geom_segment(size = 2),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_line(aes(y=log(Cases), color=Index>0), size=0.5)
)
sp3
b<-cumsum(rnorm(100))
x<-sample(c(1,2), size=100, replace=TRUE)
t<-1:(length(b))
library(reshape2)
library(ggplot2)
tmp <- melt(data.frame(cbind(t,b,x)),meas=c("x"))
head(tmp)
ggplot(tmp, aes(x=t,groups=variable)) +
facet_wrap(~variable) +
geom_path(aes(y=b,colour=factor(value))) +
labs(x=NULL)
ggplot(tmp, aes(x=t,groups=variable)) +
facet_wrap(~variable)
ggplot(tmp, aes(x=t,groups=variable)) +
facet_wrap(~variable) +
geom_path(aes(y=b,colour=factor(value)))
ggplot(tmp, aes(x=t,group=variable)) +
facet_wrap(~variable) +
geom_path(aes(y=b,colour=factor(value)))
b<-cumsum(rnorm(100))
x<-sample(c(1,2), size=100, replace=TRUE)
t<-1:(length(b))
library(reshape2)
library(ggplot2)
tmp <- melt(data.frame(cbind(t,b,x)),meas=c("x"))
head(tmp)
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
geom_segment(size = 2),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(Index>0)))
)
sp3
tmp
EVI_output$x<-"x"
EVI_output
sp3<-ggplot(EVI_output, aes(x=Days),group=x)+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(Index>0)))
)
sp3
head(tmp)
EVI_output$x<-"x"
EVI_output$cond<-Index>0
sp3<-ggplot(EVI_output, aes(x=Days),group=x)+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(cond)))
)
sp3
EVI_output
EVI_output$cond<-Index>0
EVI_output$cond<-EVI_output$Index>0
sp3<-ggplot(EVI_output, aes(x=Days),group=x)+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(cond)))
)
sp3
EVI_output$cond
head(tmp)
EVI_output$cond<-as.numeric(EVI_output$Index>0)
sp3<-ggplot(EVI_output, aes(x=Days),group=x)+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(cond)))
)
sp3
EVI_output
EVI_output$cond<-as.numeric(EVI_output$Index>0)+1
sp3<-ggplot(EVI_output, aes(x=Days),group=x)+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(cond)))
)
sp3
EVI_output
sp3<-ggplot(EVI_output, aes(x=Days),group=x)+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days")
)
sp3
head(tmp)
EVI_output$variable<-"x"
EVI_output$cond<-as.numeric(EVI_output$Index>0)+1
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(cond)))
)
sp3
as.numeric(EVI_output$Index>0)+1
type
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "Cases", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days))+
list(
geom_point(aes(y=(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "Cases", x="Days"),
if (type=="l")  geom_path(aes(y=Cases,colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable)))+
list(
geom_point(aes(y=(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "Cases", x="Days"),
if (type=="l")  geom_path(aes(y=Cases,colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable)))+
list(
geom_point(aes(y=(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "Cases", x="Days"),
if (type=="l")  geom_path(aes(y=Cases,colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=log(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "ln(Cases)", x="Days"),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable)))+
list(
geom_point(aes(y=(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "Cases", x="Days"),
if (type=="l")  geom_path(aes(y=Cases,colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable)))+
list(
geom_point(aes(y=(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "Cases", x="Days"),
if (type=="l")  geom_path(aes(y=Cases,colour=factor(Index>0)))
)
sp3
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable)))+
list(
geom_point(aes(y=(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "Cases", x="Days"),
if (type=="l")  geom_path(aes(y=Cases,colour=factor(Index>0)))
)
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(Cases), color=Index>0), size=0.5),
scale_color_manual(values=c("grey69", "red3")),
theme(legend.position = "none"),
labs(y = "Cases", x="Days"),
if (type=="l")  geom_path(aes(y=Cases,colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(cases_1), col=pvs), size=0.5),
geom_point(aes(y=(cases_0)), col="grey69", size=0.5),
labs(y = "Cases", x=""),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "PPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm')),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(Index>0)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(cases_1), col=pvs), size=0.5),
geom_point(aes(y=(cases_0)), col="grey69", size=0.5),
labs(y = "Cases", x=""),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "PPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm'))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(cases_1), col=pvs), size=0.5),
geom_point(aes(y=(cases_0)), col="grey69", size=0.5),
labs(y = "Cases", x=""),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "PPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm')),
if (type=="l")  geom_path(aes(y=log(Cases),colour=factor(pvs)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(cases_1), col=pvs), size=0.5),
geom_point(aes(y=(cases_0)), col="grey69", size=0.5),
labs(y = "Cases", x=""),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "PPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm')),
if (type=="l")  geom_path(aes(y=(cases_1),colour=factor(pvs)))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(cases_1), col=pvs), size=0.5),
geom_point(aes(y=(cases_0)), col="grey69", size=0.5),
labs(y = "Cases", x=""),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "PPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm'))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(cases_0), col=pvn), size=0.5),
geom_point(aes(y=(cases_1)), col="grey69", size=0.5),
labs(y = "Cases"),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "NPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm'))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=log(cases_0), col=pvn), size=0.5),
geom_point(aes(y=log(cases_1)), col="grey69", size=0.5),
labs(y = "ln(Cases)"),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "NPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm'))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(cases_0), col=pvn), size=0.5),
geom_point(aes(y=(cases_1)), col="grey69", size=0.5),
labs(y = "Cases"),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "NPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm'))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=log(cases_1), col=pvs), size=0.5),
geom_point(aes(y=log(cases_0)), col="grey69", size=0.5),
labs(y = "ln(Cases)", x=""),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "PPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm'))
)
sp3
sp3<-ggplot(EVI_output, aes(x=Days,group=variable))+
list(
geom_point(aes(y=(cases_1), col=pvs), size=0.5),
geom_point(aes(y=(cases_0)), col="grey69", size=0.5),
labs(y = "Cases", x=""),
scale_color_gradient(low = "green", high = "red", limits=c(0, 1)),
labs(color= "PPV"),
theme(legend.position = c(0.95, 0.3),
legend.title = element_text(size=10),
legend.text = element_text(size=8),
legend.key.height = unit(0.5, 'cm'))
)
sp3
devtools::document()
